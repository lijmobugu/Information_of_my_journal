{% extends 'base.html' %}

{% block title %}{{ journal.journal_name }}{% endblock %}

{% block content %}
    <a href="{{ url_for('journals_list') }}">&larr; 返回列表</a>
    <h1>{{ journal.journal_name }}</h1>

    <div class="field">
        <a href="{{ journal.official_guidelines_url }}" target="_blank">查看官方投稿指南 &rarr;</a>
    </div>

    {% if journal.issn %}
    <div class="field">
        <span class="field-label">ISSN:</span> {{ journal.issn }}
    </div>
    {% endif %}

    <!-- ... [其他字段照常显示] ... -->

    <hr>
    <form action="{{ url_for('flag_journal', journal_id=journal.id) }}" method="post" style="display: inline-block; margin-right: 10px;">
        <button type="submit">标记为不准确/已过时 ({{ journal.flags_count }})</button>
    </form>

    {% if g.user and g.user.role == 'admin' %}
        <form action="{{ url_for('delete_journal', journal_id=journal.id) }}" method="post" style="display: inline-block;">
            <button type="submit" onclick="return confirm('您确定要永久删除此条目吗？');" class="danger">删除此条目</button>
        </form>
    {% endif %}

    <div class="history">
        <h3>更新历史</h3>
        {% for record in journal.update_history %}
        <div class="history-item">
            <strong>{{ record.timestamp.strftime('%Y-%m-%d %H:%M') }}</strong> by <em>{{ record.author }}</em><br>
            <p>{{ record.changes }}</p>
        </div>
        {% else %}
        <p>暂无更新历史。</p>
        {% endfor %}
    </div>

    <div class="comments">
        <h3>社区评论</h3>
        {% for comment in journal.comments %}
        <div class="comment-item">
            <strong>{{ comment.author }}</strong> at <em>{{ comment.timestamp.strftime('%Y-%m-%d %H:%M') }}</em><br>
            <p>{{ comment.text }}</p>
        </div>
        {% else %}
        <p>还没有评论。</p>
        {% endfor %}
        
        <h4>发表评论</h4>
        {% if g.user %}
            <form action="{{ url_for('add_comment', journal_id=journal.id) }}" method="post">
                <textarea name="comment_text" rows="3" style="width: 100%;" required></textarea><br>
                <button type="submit">提交评论</button>
            </form>
        {% else %}
            <p>请<a href="{{ url_for('login') }}">登录</a>后发表评论。</p>
        {% endif %}
    </div>
{% endblock %}
